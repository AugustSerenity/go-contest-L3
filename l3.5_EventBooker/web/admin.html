<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Администратор - EventBooker</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>Админ-панель EventBooker</h1>

    <div class="btn-group">
        <button onclick="location.href='/'">Главная</button>
        <button onclick="location.href='/user'">Пользователь</button>
    </div>

    <div class="admin-section">
        <h2>Создать мероприятие</h2>
        <div class="form-group">
            <label for="event-name">Название:</label>
            <input type="text" id="event-name">
        </div>
        <div class="form-group">
            <label for="event-datetime">Дата и время:</label>
            <input type="text" id="event-datetime" placeholder="дд.мм.гггг, --:--">
        </div>
        <div class="form-group">
            <label for="event-capacity">Вместимость:</label>
            <input type="number" id="event-capacity" min="1">
        </div>
        <div class="form-group">
            <label for="event-ttl">TTL оплаты (минуты):</label>
            <input type="number" id="event-ttl" value="30" min="1">
        </div>
        <button onclick="createEvent()">Создать мероприятие</button>
        <div id="create-result"></div>
    </div>

    <div class="admin-section">
        <h2>Управление бронированиями</h2>
        <div class="form-group">
            <label for="admin-event-id">ID мероприятия:</label>
            <input type="number" id="admin-event-id">
            <button onclick="loadBookings()">Показать бронирования</button>
        </div>
        <div id="bookings-list">Выберите мероприятие для просмотра бронирований</div>
    </div>

    <script src="/static/eventLib.js"></script>
    <script>
        async function createEvent() {
            const name = document.getElementById('event-name').value;
            const datetime = document.getElementById('event-datetime').value;
            const capacity = parseInt(document.getElementById('event-capacity').value);
            const ttl = parseInt(document.getElementById('event-ttl').value);
            const resultDiv = document.getElementById('create-result');

            const result = await EventAPI.createEvent({name, datetime, capacity, ttl});

            if (result.error) {
                resultDiv.innerHTML = `<div class="error">Ошибка: ${result.error}</div>`;
            } else {
                resultDiv.innerHTML = `<div class="success">Мероприятие создано успешно! ID: ${result.id}</div>`;
            }
        }

        async function loadBookings() {
            const eventId = parseInt(document.getElementById('admin-event-id').value);
            const container = document.getElementById('bookings-list');

            if (!eventId) {
                container.innerHTML = '<div class="error">Введите ID мероприятия</div>';
                return;
            }

            const bookings = await EventAPI.fetchBookings(eventId);
            container.innerHTML = '';

            bookings.forEach(booking => {
                const bookingDiv = document.createElement('div');
                bookingDiv.classList.add('booking');
                bookingDiv.innerHTML = `
                    <p>Бронь #${booking.id} | Мест: ${booking.seats} | Статус: ${booking.paid ? '✅ Оплачено' : '⏳ Ожидает оплаты'}</p>
                `;

                if (!booking.paid) {
                    const confirmBtn = document.createElement('button');
                    confirmBtn.textContent = 'Подтвердить';
                    confirmBtn.onclick = async () => {
                        await EventAPI.confirmBooking(booking.id);
                        loadBookings();
                    };
                    bookingDiv.appendChild(confirmBtn);
                }

                container.appendChild(bookingDiv);
            });
        }
    </script>
</body>
</html>
