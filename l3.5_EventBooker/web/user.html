<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EventBooker - User</title>
</head>
<body>
  <h1>События</h1>
  <div id="events"></div>

  <script>
    async function loadEvents() {
      const res = await fetch("/events");
      const events = await res.json();
      const container = document.getElementById("events");
      container.innerHTML = "";

      events.forEach(event => {
        const div = document.createElement("div");
        div.innerHTML = `
          <h2>${event.name} (${event.date})</h2>
          <p>Свободные места: ${event.availableSeats}</p>
          <button onclick="book(${event.id})">Забронировать</button>
          <button onclick="showBookings(${event.id})">Показать брони</button>
          <div id="bookings-${event.id}"></div>
        `;
        container.appendChild(div);
      });
    }

    async function book(eventID) {
      const res = await fetch(`/events/${eventID}/book`, { method: "POST" });
      if (res.ok) {
        alert("Бронь создана!");
        loadEvents();
      } else {
        alert("Ошибка при бронировании");
      }
    }

    async function confirmBooking(eventID, bookingID) {
      const res = await fetch(`/events/${eventID}/confirm`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ bookingID })
      });
      if (res.ok) {
        alert("Бронь подтверждена!");
        showBookings(eventID);
        loadEvents();
      } else {
        alert("Ошибка подтверждения");
      }
    }

    async function showBookings(eventID) {
      const res = await fetch(`/events/${eventID}/bookings`);
      const bookings = await res.json();
      const container = document.getElementById(`bookings-${eventID}`);
      container.innerHTML = "";
      bookings.forEach(b => {
        const btn = b.confirmed
          ? "Подтверждена"
          : `<button onclick="confirmBooking(${eventID}, ${b.id})">Подтвердить</button>`;
        container.innerHTML += `<p>Бронь #${b.id} — ${btn}</p>`;
      });
    }

    loadEvents();
  </script>
</body>
</html>
